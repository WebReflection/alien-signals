var e;function t({update:e,notify:t,unwatched:i}){return{link:function(e,t){const i=t.depsTail;if(void 0!==i&&i.dep===e)return;let n;const s=4&t.flags;if(s&&(n=void 0!==i?i.nextDep:t.deps,void 0!==n&&n.dep===e))return void(t.depsTail=n);const u=e.subsTail;if(void 0!==u&&u.sub===t&&(!s||o(u,t)))return;const r=t.depsTail=e.subsTail={dep:e,sub:t,prevDep:i,nextDep:n,prevSub:u,nextSub:void 0};void 0!==n&&(n.prevDep=r);void 0!==i?i.nextDep=r:t.deps=r;void 0!==u?u.nextSub=r:e.subs=r},unlink:n,propagate:function(e){let i,n=e.nextSub;e:for(;;){const s=e.sub;let u=s.flags;if(3&u&&(60&u?12&u?4&u?48&u||!o(e,s)?u=0:(s.flags=40|u,u&=1):s.flags=-9&u|32:u=0:s.flags=32|u,2&u&&t(s),1&u)){const t=s.subs;if(void 0!==t){e=t,void 0!==t.nextSub&&(i={value:n,prev:i},n=e.nextSub);continue}}if(void 0===(e=n)){for(;void 0!==i;)if(e=i.value,i=i.prev,void 0!==e){n=e.nextSub;continue e}break}n=e.nextSub}},checkDirty:function(t,i){let n,o=0;e:for(;;){const u=t.dep,r=u.flags;let l=!1;if(16&i.flags)l=!0;else if(17&~r){if(!(33&~r)){void 0===t.nextSub&&void 0===t.prevSub||(n={value:t,prev:n}),t=u.deps,i=u,++o;continue}}else if(e(u)){const e=u.subs;void 0!==e.nextSub&&s(e),l=!0}if(l||void 0===t.nextDep){for(;o;){--o;const u=i.subs,r=void 0!==u.nextSub;if(r?(t=n.value,n=n.prev):t=u,l){if(e(i)){r&&s(u),i=t.sub;continue}}else i.flags&=-33;if(i=t.sub,void 0!==t.nextDep){t=t.nextDep;continue e}l=!1}return l}t=t.nextDep}},endTracking:function(e){const t=e.depsTail;let i=void 0!==t?t.nextDep:e.deps;for(;void 0!==i;)i=n(i,e);e.flags&=-5},startTracking:function(e){e.depsTail=void 0,e.flags=-57&e.flags|4},shallowPropagate:s};function n(e,t=e.sub){const n=e.dep,s=e.prevDep,o=e.nextDep,u=e.nextSub,r=e.prevSub;return void 0!==o?o.prevDep=s:t.depsTail=s,void 0!==s?s.nextDep=o:t.deps=o,void 0!==u?u.prevSub=r:n.subsTail=r,void 0!==r?r.nextSub=u:void 0===(n.subs=u)&&i(n),o}function s(e){do{const i=e.sub,n=e.nextSub,s=i.flags;32==(48&s)&&(i.flags=16|s,2&s&&t(i)),e=n}while(void 0!==e)}function o(e,t){const i=t.depsTail;if(void 0!==i){let n=t.deps;do{if(n===e)return!0;if(n===i)break;n=n.nextDep}while(void 0!==n)}return!1}}!function(e){e[e.None=0]="None",e[e.Mutable=1]="Mutable",e[e.Watching=2]="Watching",e[e.RecursedCheck=4]="RecursedCheck",e[e.Recursed=8]="Recursed",e[e.Dirty=16]="Dirty",e[e.Pending=32]="Pending"}(e||(e={}));const i=[],n=[],{link:s,unlink:o,propagate:u,checkDirty:r,endTracking:l,startTracking:d,shallowPropagate:a}=t({update:e=>"getter"in e?V(e):C(e,e.value),notify:function e(t){const i=t.flags;if(!(64&i)){t.flags=64|i;const s=t.subs;void 0!==s?e(s.sub):n[b++]=t}},unwatched(e){if("getter"in e){let t=e.deps;if(void 0!==t){e.flags=17;do{t=o(t,e)}while(void 0!==t)}}else"previousValue"in e||E.call(e)}});let f,v,c=0,p=0,b=0;function g(){return f}function h(e){const t=f;return f=e,t}function x(){return v}function T(e){const t=v;return v=e,t}function D(){++c}function y(){--c||N()}function k(){i.push(h(void 0))}function S(){h(i.pop())}function w(e){return m.bind({previousValue:e,value:e,subs:void 0,subsTail:void 0,flags:1})}function _(e){return W.bind({value:void 0,subs:void 0,subsTail:void 0,deps:void 0,depsTail:void 0,flags:17,getter:e})}function P(e){const t={fn:e,subs:void 0,subsTail:void 0,deps:void 0,depsTail:void 0,flags:2};void 0!==f?s(t,f):void 0!==v&&s(t,v);const i=h(t);try{t.fn()}finally{h(i)}return E.bind(t)}function R(e){const t={deps:void 0,depsTail:void 0,subs:void 0,subsTail:void 0,flags:0};void 0!==v&&s(t,v);const i=h(void 0),n=T(t);try{e()}finally{T(n),h(i)}return E.bind(t)}function V(e){const t=h(e);d(e);try{const t=e.value;return t!==(e.value=e.getter(t))}finally{h(t),l(e)}}function C(e,t){return e.flags=1,e.previousValue!==(e.previousValue=t)}function M(e,t){if(16&t||32&t&&r(e.deps,e)){const t=h(e);d(e);try{e.fn()}finally{h(t),l(e)}return}32&t&&(e.flags=-33&t);let i=e.deps;for(;void 0!==i;){const e=i.dep,t=e.flags;64&t&&M(e,e.flags=-65&t),i=i.nextDep}}function N(){for(;p<b;){const e=n[p];n[p++]=void 0,M(e,e.flags&=-65)}p=0,b=0}function W(){const e=this.flags;if(16&e||32&e&&r(this.deps,this)){if(V(this)){const e=this.subs;void 0!==e&&a(e)}}else 32&e&&(this.flags=-33&e);return void 0!==f?s(this,f):void 0!==v&&s(this,v),this.value}function m(...e){if(!e.length){const e=this.value;if(16&this.flags&&C(this,e)){const e=this.subs;void 0!==e&&a(e)}return void 0!==f&&s(this,f),e}{const t=e[0];if(this.value!==(this.value=t)){this.flags=17;const e=this.subs;void 0!==e&&(u(e),c||N())}}}function E(){let e=this.deps;for(;void 0!==e;)e=o(e,this);const t=this.subs;void 0!==t&&o(t),this.flags=0}const O={greedy:!1},j=e=>new B(e),q=(e,{greedy:t=!1}=O)=>t?new F(e):new A(w,e),z=e=>{k();try{return e()}finally{S()}};class A{constructor(e,t){this._=e(t)}get value(){return this._()}set value(e){this._(e)}peek(){return z(this._)}valueOf(){return this.value}}class B extends A{constructor(e){super(_,e)}get value(){return this._()}set value(e){throw new Error("Computed values are read-only")}}class F extends A{constructor(e){super(w,[e])}get value(){return super.value[0]}set value(e){super.value=[e]}peek(){return super.peek()[0]}}export{B as Computed,e as ReactiveFlags,A as Signal,c as batchDepth,j as computed,t as createReactiveSystem,P as effect,R as effectScope,y as endBatch,x as getCurrentScope,g as getCurrentSub,k as pauseTracking,S as resumeTracking,T as setCurrentScope,h as setCurrentSub,q as signal,D as startBatch,z as untracked};
