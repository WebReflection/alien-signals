var e,t=((e=t||{})[e.Computed=1]="Computed",e[e.Effect=2]="Effect",e[e.Tracking=4]="Tracking",e[e.Notified=8]="Notified",e[e.Recursed=16]="Recursed",e[e.Dirty=32]="Dirty",e[e.PendingComputed=64]="PendingComputed",e[e.PendingEffect=128]="PendingEffect",e[e.Propagated=224]="Propagated",e);function n({updateComputed:e,notifyEffect:t}){const n=[];let i=0,s=0;return{link:function(e,t){const n=t.depsTail;if(void 0!==n&&n.dep===e)return;const i=void 0!==n?n.nextDep:t.deps;if(void 0!==i&&i.dep===e)return void(t.depsTail=i);const s=e.subsTail;if(void 0!==s&&s.sub===t&&d(s,t))return;return function(e,t,n,i){const s={dep:e,sub:t,nextDep:n,prevSub:void 0,nextSub:void 0};void 0===i?t.deps=s:i.nextDep=s;if(void 0===e.subs)e.subs=s;else{const t=e.subsTail;s.prevSub=t,t.nextSub=s}return t.depsTail=s,e.subsTail=s,s}(e,t,i,n)},propagate:function(e){let t,i=e.nextSub,o=0,u=32;e:for(;;){const f=e.sub,r=f.flags;let c=!1;if(244&r?16&r&&!(4&r)?(f.flags=-17&r|u|8,c=!0):224&r||!d(e,f)||(f.flags=16|r|u|8,c=void 0!==f.subs):(f.flags=r|u|8,c=!0),c){const d=f.subs;if(void 0!==d){e=d,void 0!==d.nextSub?(t={target:i,linked:t},++o,i=e.nextSub,u=64):u=2&r?128:64;continue}2&r&&(n[s++]=f)}else r&(4|u)?!(r&u)&&224&r&&d(e,f)&&(f.flags=r|u):(f.flags=r|u|8,2==(10&r)&&(n[s++]=f));if(void 0===(e=i)){for(;o--;)if(e=t.target,t=t.linked,void 0!==e){i=e.nextSub,u=o?64:32;continue e}break}i=e.nextSub,u=o?64:32}},updateDirtyFlag:function(e,t){return o(e.deps)?(e.flags=32|t,!0):(e.flags=-65&t,!1)},startTracking:function(e){e.depsTail=void 0,e.flags=-249&e.flags|4},endTracking:function(e){const t=e.depsTail;if(void 0!==t){const e=t.nextDep;void 0!==e&&(f(e),t.nextDep=void 0)}else void 0!==e.deps&&(f(e.deps),e.deps=void 0);e.flags&=-5},processEffectNotifications:function(){for(;i<s;){const e=n[i];n[i++]=void 0,t(e)||(e.flags&=-9)}i=0,s=0},processComputedUpdate:function(t,n){if(32&n||o(t.deps)){if(e(t)){const e=t.subs;void 0!==e&&u(e)}}else t.flags=-65&n},processPendingInnerEffects:function(e,n){if(128&n){e.flags=-129&n;let i=e.deps;do{const e=i.dep;"flags"in e&&2&e.flags&&224&e.flags&&t(e),i=i.nextDep}while(void 0!==i)}}};function o(t){let n,i,s=0;e:for(;;){i=!1;const o=t.dep;if(32&t.sub.flags)i=!0;else if("flags"in o){const d=o.flags;if(33&~d){if(!(65&~d)){void 0===t.nextSub&&void 0===t.prevSub||(n={target:t,linked:n}),t=o.deps,++s;continue}}else if(e(o)){const e=o.subs;void 0!==e.nextSub&&u(e),i=!0}}if(i||void 0===t.nextDep){for(;s;){--s;const o=t.sub,d=o.subs;if(i){if(e(o)){void 0!==d.nextSub?(t=n.target,n=n.linked,u(d)):t=d;continue}}else o.flags&=-65;if(void 0!==d.nextSub?(t=n.target,n=n.linked):t=d,void 0!==t.nextDep){t=t.nextDep;continue e}i=!1}return i}t=t.nextDep}}function u(e){do{const t=e.sub,i=t.flags;64==(96&i)&&(t.flags=40|i,2==(10&i)&&(n[s++]=t)),e=e.nextSub}while(void 0!==e)}function d(e,t){const n=t.depsTail;if(void 0!==n){let i=t.deps;do{if(i===e)return!0;if(i===n)break;i=i.nextDep}while(void 0!==i)}return!1}function f(e){do{const t=e.dep,n=e.nextDep,i=e.nextSub,s=e.prevSub;if(void 0!==i?i.prevSub=s:t.subsTail=s,void 0!==s?s.nextSub=i:t.subs=i,void 0===t.subs&&"deps"in t){const i=t.flags;32&i||(t.flags=32|i);const s=t.deps;if(void 0!==s){e=s,t.depsTail.nextDep=n,t.deps=void 0,t.depsTail=void 0;continue}}e=n}while(void 0!==e)}}var i,s,{link:o,propagate:u,updateDirtyFlag:d,startTracking:f,endTracking:r,processEffectNotifications:c,processComputedUpdate:a,processPendingInnerEffects:l}=n({updateComputed(e){const t=i;i=e,f(e);try{const t=e.currentValue,n=e.getter(t);return t!==n&&(e.currentValue=n,!0)}finally{i=t,r(e)}},notifyEffect:e=>"isScope"in e?function(e){const t=e.flags;if(128&t)return l(e,e.flags),!0;return!1}(e):function(e){const t=e.flags;if(32&t||64&t&&d(e,t)){const t=i;i=e,f(e);try{e.fn()}finally{i=t,r(e)}}else l(e,e.flags);return!0}(e)}),p=[],v=0;function g(){++v}function b(){--v||c()}function x(){p.push(i),i=void 0}function h(){i=p.pop()}function T(e){return E.bind({currentValue:e,subs:void 0,subsTail:void 0})}function S(e){return y.bind({currentValue:void 0,subs:void 0,subsTail:void 0,deps:void 0,depsTail:void 0,flags:33,getter:e})}function D(e){const t={fn:e,subs:void 0,subsTail:void 0,deps:void 0,depsTail:void 0,flags:2};void 0!==i?o(t,i):void 0!==s&&o(t,s);const n=i;i=t;try{t.fn()}finally{i=n}return m.bind(t)}function k(e){const t={deps:void 0,depsTail:void 0,flags:2,isScope:!0},n=s;s=t;try{e()}finally{s=n}return m.bind(t)}function y(){const e=this.flags;return 96&e&&a(this,e),void 0!==i?o(this,i):void 0!==s&&o(this,s),this.currentValue}function E(...e){if(!e.length)return void 0!==i&&o(this,i),this.currentValue;if(this.currentValue!==(this.currentValue=e[0])){const e=this.subs;void 0!==e&&(u(e),v||c())}}function m(){f(this),r(this)}const C=e=>new N(e),P=e=>new _(e),V=e=>{x();try{return e()}finally{h()}};class w{constructor(e,t){this._=e(t)}peek(){return V(this._)}valueOf(){return this.value}}class _ extends w{constructor(e){super(T,e)}get value(){return this._()}set value(e){this._(e)}}class N extends w{constructor(e){super(S,e)}get value(){return this._()}}export{N as Computed,w as Signal,_ as State,t as SubscriberFlags,v as batchDepth,C as computed,n as createReactiveSystem,D as effect,k as effectScope,b as endBatch,x as pauseTracking,h as resumeTracking,P as signal,g as startBatch,V as untracked};
